## ìµœì†Œ ê³µí†µ ì¡°ìƒ

ì˜ì–´ë¡œ Lowest Common Ancestor(LCA)ë¼ê³ ë„ ë¶ˆë¦¬ëŠ” ì´ ì•Œê³ ë¦¬ì¦˜ì€ ì˜ì–´ í•´ì„ ê·¸ëŒ€ë¡œ ìµœì†Œ ê³µí†µ ì¡°ìƒì„ ì°¾ëŠ” ì•Œê³ ë¦¬ì¦˜ì´ë‹¤.

ì´ë¥¼ í’€ì–´ì„œ í•´ì„í•´ë³´ìë©´, ë‘ ì •ì  u,vì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ ê³µí†µ ì¡°ìƒì„ ì°¾ëŠ” ê³¼ì •ì„ ë§í•œë‹¤.

![LCAê·¸ë˜í”„](/img/algorithms/LCA/lca01.png)

ìœ„ì˜ ê·¸ë˜í”„ë¥¼ ë³´ë©´ LCA(x, y)ëŠ” ì§„í•œ ì´ˆë¡ìƒ‰ì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.

ì—°í•œ ë…¹ìƒ‰ì€ x,yì˜ ê³µí†µ ì¡°ìƒì´ê¸°ëŠ” í•˜ì§€ë§Œ ìµœì†ŒëŠ” ì•„ë‹ˆë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.

## êµ¬í˜„ ë°©ì‹ì˜ ì¢…ë¥˜

êµ¬í˜„ ë°©ë²•ì€ í¬ê²Œ ì„¸ê·¸ë¨¼íŠ¸ íŠ¸ë¦¬ ë°©ì‹ê³¼ dp ë°©ì‹ì´ ìˆë‹¤. ì•„ì§ ì„¸ê·¸ë¨¼íŠ¸ë¦¬ëŠ” ë°°ìš°ì§€ ì•Šì•˜ìœ¼ë‹ˆ ì—¬ê¸°ì„œëŠ” dpê³¼ì •ë§Œ ë°°ì›Œë³´ë„ë¡ í•˜ê² ë‹¤.

ì„¸ê·¸ë¨¼íŠ¸ íŠ¸ë¦¬ë¥¼ í™œìš©í•œ êµ¬í˜„ë°©ë²•ì´ ê¶ê¸ˆí•œ ì‚¬ëŒì„ ìœ„í•´ [ë§í¬](https://www.geeksforgeeks.org/find-lca-in-binary-tree-using-rmq/)ë¥¼ ë¶™ì—¬ ë†“ë„ë¡ í•˜ê² ë‹¤.

ì°¸ê³ ë¡œ ë‘ ê°€ì§€ ì•Œê³ ë¦¬ì¦˜ ëª¨ë‘ ì‹œê°„ë³µì¡ë„ê°€ ë™ì¼í•˜ë‹¤. ìì„¸í•œ ì‹œê°„ ë³µì¡ë„ëŠ” dp ì•Œê³ ë¦¬ì¦˜ì„ êµ¬í˜„í•˜ë©° ì†Œê°œí•´ë³´ë„ë¡ í•˜ê² ë‹¤.

## LCA ì•Œê³ ë¦¬ì¦˜ì˜ êµ¬í˜„

ê¸°ë³¸ì ìœ¼ë¡œ LCA ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

1. ëª¨ë“  ë…¸ë“œì— ëŒ€í•œ ê¹Šì´ë¥¼ ê³„ì‚°í•œë‹¤.
2. ìµœì†Œ ê³µí†µ ì¡°ìƒì„ ì°¾ì„ ë‘ ë…¸ë“œë¥¼ í™•ì¸í•œë‹¤.
   1. ë¨¼ì € ë‘ ë…¸ë“œì˜ ê¹Šì´ê°€ ë™ì¼í•˜ë„ë¡ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°„ë‹¤.
   2. ì´í›„ì— ë¶€ëª¨ê°€ ê°™ì•„ì§ˆ ë•Œê¹Œì§€ ë°˜ë³µì ìœ¼ë¡œ ë‘ ë…¸ë“œì˜ ë¶€ëª¨ ë°©í–¥ìœ¼ë¡œ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°„ë‹¤.
3. ëª¨ë“  LCA(a, b)ì—°ì‚°ì— ëŒ€í•˜ì—¬ 2ë²ˆ ê³¼ì •ì„ ë°˜ë³µí•œë‹¤.

ì´ ê³¼ì •ì„ ê·¸ë¦¼ìœ¼ë¡œ ì˜ˆë¥¼ ë“¤ì–´ê°€ë©° ë³´ë„ë¡ í•˜ì.

1. ë¨¼ì € ì•„ë˜ì™€ ê°™ì´ 8ë²ˆ ë…¸ë“œì™€ 15ë²ˆ ë…¸ë“œì˜ ê³µí†µ ì¡°ìƒì„ ì°¾ì•„ì•¼ í•˜ëŠ” ìƒí™©ì´ë¼ê³  ê°€ì •í•´ë³´ì

   ![LCA02](/img/algorithms/LCA/lca02.png)

2. ì´ì œ ë‘ ë…¸ë“œì˜ ê¹Šì´ë¥¼ ë§ì¶° ì¤€ë‹¤. 15ê°€ 8ë³´ë‹¤ ë†’ì´ê°€ 1ì´ ë” ë‚®ìœ¼ë¯€ë¡œ 11ë¡œ ì˜¬ë ¤ ë†’ì´ë¥¼ ë§ì¶˜ë‹¤.

   ![LCA03](/img/algorithms/LCA/lca03.png)

3. ë…¸ë“œì˜ ë†’ì´ë¥¼ ì˜¬ë¼ê°€ë©° ê³µí†µëœ ì¡°ìƒì„ ì°¾ëŠ”ë‹¤.

   ![LCA04](/img/algorithms/LCA/lca04.png)

ì´ë ‡ê²Œ ë§¤ ì¿¼ë¦¬ë§ˆë‹¤ ë¶€ëª¨ ë°©í–¥ìœ¼ë¡œ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ë©´ ìµœì•…ì˜ ê²½ìš° $O(N)$ì˜ ì‹œê°„ë³µì¡ë„ê°€ ìš”êµ¬ëœë‹¤. ë”°ë¼ì„œ ëª¨ë“  ì¿¼ë¦¬Mê°œë¥¼ ì²˜ë¦¬í•  ë•Œì˜ ì‹œê°„ ë³µì¡ë„ëŠ” $O(NM)$ì´ë‹¤.

:::tip
ì—¬ê¸°ì„œ Nì€ íŠ¸ë¦¬ì˜ ë†’ì´ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
:::

ì´ê²ƒì„ ì¢€ë” íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ dpì´ë‹¤. dpë¥¼ ì‚¬ìš©í•˜ë©´ ë¶€ëª¨ ë°©í–¥ìœ¼ë¡œ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ëŠ” ì‹œê°„ë³µì¡ë„ë¥¼ $O(logN)$ìœ¼ë¡œ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

ê¸°ì¡´ì˜ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ëŠ” ë…¸ë“œì˜ ì†ë„ë¥¼ í•œì¹¸ì”© ì˜¬ë¼ê°”ë‹¤ë©´ dpë¥¼ ì‚¬ìš©í•˜ì—¬ $2^n$ì†ë„ë¡œ ì˜¬ë¼ê°ˆ ìˆ˜ ìˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì´ 15ì¹¸ ì˜¬ë¼ê°€ì•¼ í•œë‹¤ë©´ 8ì¹¸ -> 4ì¹¸ -> 2ì¹¸ -> 1ì¹¸ ì´ëŸ°ì‹ìœ¼ë¡œ ì˜¬ë¼ê°€ëŠ” ê²ƒì´ë‹¤. ì•„ë˜ ê·¸ë¦¼ ì²˜ëŸ¼ dpë°°ì—´ì— $2^i$ ë²ˆì§¸ ì¡°ìƒì˜ ë…¸ë“œë¥¼ ê¸°ë¡í•´ë‘ë©´ ëœë‹¤.
![LCA05](/img/algorithms/LCA/lca05.png)

:::info

LCAëŠ” ì˜¤ì§ binary-treeì—ì„œë§Œ ì‚¬ìš©ê°€ëŠ¥ í•œê°€? NO! - [êµ¬í˜„ ë§í¬](https://www.geeksforgeeks.org/lca-for-general-or-n-ary-trees-sparse-matrix-dp-approach-onlogn-ologn/)

:::

## ì½”ë“œ

```python
import sys
sys.setrecursionlimit(100000) # ëŸ°íƒ€ì„ ì˜¤ë¥˜ë¥¼ í”¼í•˜ê¸° ìœ„í•œ ì¬ê·€ ê¹Šì´ ì œí•œ ì„¤ì •
input = sys.stdin.readline # ì‹œê°„ ì´ˆê³¼ë¥¼ í”¼í•˜ê¸° ìœ„í•œ ë¹ ë¥¸ ì…ë ¥ í•¨ìˆ˜
LENGTH = 21 # 2 ^ 20 = 1,000,000

n = int(input())
parent = [[0] * LENGTH for _ in range(n + 1)] # ë¶€ëª¨ ë…¸ë“œ ì •ë³´
visited = [False] * (n + 1) # ê° ë…¸ë“œì˜ ê¹Šì´ê°€ ê³„ì‚° ë˜ì—ˆëŠ”ì§€ì˜ ì—¬ë¶€
d = [0] * (n + 1) # ê° ë…¸ë“œê¹Œì§€ì˜ ê¹Šì´
graph = [[] for _ in range(n + 1)] # ê·¸ë˜í”„ ì •ë³´

# ì–‘ ë°©í–¥ íŠ¸ë¦¬ ë§Œë“¤ì–´ì£¼ê¸°
for _ in range(n - 1):
    a, b = map(int, input().split())
    graph[a].append(b)
    graph[b].append(a)

# ë£¨íŠ¸ ë…¸ë“œë¶€í„° ì‹œì‘í•˜ì—¬ ê¹Šì´ë¥¼ êµ¬í•˜ëŠ” í•¨ìˆ˜
def dfs(x, depth):
    visited[x] = True
    d[x] = depth

    for node in graph[x]:
        if visited[node]: # ì´ë¯¸ ê¹Šì´ë¥¼ êµ¬í–ˆë‹¤ë©´ ë„˜ê¸°ê¸°
            continue
        # ìš°ì„  ë°”ë¡œ ìœ„ì— ìˆëŠ” ë¶€ëª¨ ì •ë³´ë§Œ ê°±ì‹ 
        parent[node][0] = x
        dfs(node, depth + 1)


# ëª¨ë“  ë…¸ë“œì˜ ì „ì²´ ë¶€ëª¨ ê´€ê³„ ê°±ì‹ í•˜ê¸°
def set_parent():
    dfs(1, 0) # ë£¨íŠ¸ ë…¸ë“œëŠ” 1ë²ˆ ë…¸ë“œ
    for i in range(1, LENGTH):
        for j in range(1, n + 1):
            # ê° ë…¸ë“œì— ëŒ€í•´ 2**ië²ˆì§¸ ë¶€ëª¨ ì •ë³´ ê°±ì‹ 
            parent[j][i] = parent[parent[j][i - 1]][i - 1]


def lca(a, b):
    # ë¬´ì¡°ê±´ bì˜ ê¹Šì´ê°€ ë” ê¹Šë„ë¡ ì„¤ì •
    if d[a] > d[b]:
        a, b = b, a

    # aì™€ bì˜ ê¹Šì´ê°€ ë™ì¼í•´ì£¼ë„ë¡ ì„¤ì •
    for i in range(LENGTH - 1, -1, -1):
        if d[b] - d[a] >= 2**i:
            b = parent[b][i]

    if a == b:
        return a

    # ì˜¬ë¼ê°€ë©´ì„œ ê³µí†µ ì¡°ìƒ ì°¾ê¸°
    for i in range(LENGTH - 1, -1, -1):
        if parent[a][i] != parent[b][i]:
            a = parent[a][i]
            b = parent[b][i]

    return parent[a][0]


set_parent()


# mê°œì˜ ì¿¼ë¦¬ì— ëŒ€í•´ lca ìˆ˜í–‰
m = int(input())

for _ in range(m):
    a, b = map(int, input().split())
    print(lca(a, b))
```

## ì˜ˆì œ ë¬¸ì œ

- [ë°±ì¤€ 11437ë²ˆ LCA](https://www.acmicpc.net/problem/11437)
- [ë°±ì¤€ 11438ë²ˆ LCA2](https://www.acmicpc.net/problem/11438)

## ë‚˜ì˜¬ ìˆ˜ ìˆëŠ” ë©´ì ‘ ì§ˆë¬¸

- LCA ì•Œê³ ë¦¬ì¦˜ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?
- LCA êµ¬í˜„ ë°©ë²•ì—ëŠ” ì–´ë–¤ ê²ƒë“¤ì´ ìˆë‚˜ìš”?
- LCAì˜ ì‹œê°„ë³µì¡ë„ëŠ” ì–´ë–»ê²Œ ë˜ë‚˜ìš”?
- LCAì˜ ì•Œê³ ë¦¬ì¦˜ì´ ì–´ë–»ê²Œ ì§„í–‰ë˜ëŠ”ì§€ íŠ¸ë¦¬ë¥¼ ë³´ë©° ì„¤ëª…í•´ì£¼ì„¸ìš”.

## ì°¸ê³ 

- [LCA ì•Œê³ ë¦¬ì¦˜ - Crocus ë¸”ë¡œê·¸](https://www.crocus.co.kr/660)
- [ë‚˜ë™ë¹ˆ ìœ íŠœë¸Œ ê°•ì˜ LCA](https://youtu.be/O895NbxirM8)

## ê¸°ì—¬ì

<td align="center"><a href="http://kyun2da.dev"><img src="https://avatars.githubusercontent.com/u/50328132?v=4?s=100" width="100px;" alt=""/><br /><sub><b>Kyun Heo</b></sub></a><br /><a href="#platform-Kyun2da" title="Packaging/porting to new platform">ğŸ“¦</a></td>
